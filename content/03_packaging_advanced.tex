\secslide[\fontsize{1.2cm}{1.2cm}\selectfont]{Packaging: The Fun Stuff}

\begin{splitframe}[fragile]{CLI Scripts}{Example}
  \begin{columns}[t,onlytextwidth]
    \begin{column}{0.58\textwidth}
      \begin{itemize}
        \setlength{\itemsep}{1em}
        \item We can expose scripts in our package using the \texttt{pyproject.toml}
          \texttt{[project.scripts]} section
        \item Similarly: Entry points, that allow the creation of plugins, and cross-platform
          compatibility
          \begin{itemize}
            \item [\textcolor{cpink}{\to}] See \href{https://setuptools.pypa.io/en/latest/userguide/entry_point.html}{{\footnotesize{\faExternalLink*}}\,Entry Points}
          \end{itemize}
      \end{itemize}
    \end{column}
    \hfill
    \begin{column}{0.38\textwidth}
      \begin{minted}{toml}
        src/my_package/cli.py:
      \end{minted}
      \vspace{0.25em}
      \begin{minted}{python}
        def print_message():
            print("Hello World!")
            raise SystemExit(1)
      \end{minted}
      \vspace{1em}
      \begin{minted}{toml}
        pyproject.toml:
      \end{minted}
      \vspace{0.25em}
      \begin{minted}{toml}
        [project.scripts]
        hello-world = "my_package.cli:print_message"
      \end{minted}
      \vspace{1em}
      \begin{center}
        \huge\textcolor{cpink}{\texttt{\textbf{Result}}}
      \end{center}
      \begin{minted}[escapeinside=||]{toml}
        |\textbf{\textcolor{cpink}{\$}}| hello-world
        Hello World!
      \end{minted}
    \end{column}
  \end{columns}
\end{splitframe}


\begin{darkframe}{Versioning}
  Remember:
  \begin{itemize}
    \item \texttt{pyproject.toml} has required fields:
    \begin{minted}{toml}
      [project]
      name = "my_package"
      version = "0.1.0"
    \end{minted}
    \item One way to get this version is with \texttt{hatch}
    \begin{minted}{shell-session}
      $ hatch version
      0.1.0
    \end{minted}
    \item We can also set a new version using \texttt{hatch}:
    \begin{minted}{shell-session}
      $ hatch version 0.2.0
      Old: 0.1.0
      New: 0.2.0
    \end{minted}
  \end{itemize}
\end{darkframe}

\begin{darkframe}{}
  \begin{tikzpicture}[
      remember picture,
      overlay,
      every node/.style={cpink, font=\bfseries\fontsize{2cm}{1cm}\selectfont},
    ]
    \node [align=left] (svs) at (current page.center) {Static\\Versions\\[0.15\baselineskip]Suck
      \hspace{0.1ex}\Large \textcolor{ccyan}{I guess\dots}};
    \node [ccyan, font=\Large, anchor=west] at ([xshift=1.3cm,yshift=-0.9cm]svs.west) {\emph{kinda}};
  \end{tikzpicture}
\end{darkframe}

\begin{splitframe}[fragile]{So Let's Do Something About It}{Code}
  \begin{columns}[t,onlytextwidth]
    {
      \usemintedstyle{code-light}
    \begin{column}{0.58\textwidth}
      \textbf{\textcolor{ccyan}{Approach \#1:}}
      \begin{itemize}
        \item We can set the \texttt{version} field to dynamic\dots
        \item \dots and set the version as \mintinline{python}+__version__ = "0.1.0"+
        in \texttt{\_\_init\_\_.py}
      \end{itemize}
    \end{column}
    }
    \begin{column}{0.38\textwidth}
      \begin{minted}{toml}
        # pyproject.toml
        [project]
        name = "my_package"
        dynamic = ["version"]

        [tool.hatch.version]
        source = "regex"
        path = "src/my_package/__init__.py"
      \end{minted}
      \vspace{1cm}
      \begin{minted}{python}
        # src/my_package/__init__.py
        __version__ = "0.1.0"
      \end{minted}
    \end{column}
  \end{columns}
\end{splitframe}

\begin{splitframe}[fragile]{So Let's Do Something About It}{Code}
  \begin{columns}[t,onlytextwidth]
    {
      \usemintedstyle{code-light}
    \begin{column}{0.58\textwidth}
      \textbf{\textcolor{ccyan}{Approach \#2:}}
      \begin{itemize}
        \setlength{\itemsep}{1em}
        \item We can set the \texttt{version} field to dynamic\dots
        \item \dots and use the version control system (\eg, \texttt{git})
          to determine the version for us
        \item We can then import the version from the file generated by \texttt{hatch-vcs}
      \end{itemize}
    \end{column}
    }
    \begin{column}{0.38\textwidth}
      \small
      \begin{minted}{toml}
        # pyproject.toml
        [build-system]
        requires = ["hatchling", "hatch-vcs"]
        build-backend = "hatchling.build"

        [project]
        name = "my_package"
        dynamic = ["version"]

        [tool.hatch.version]
        source = "vcs"

        [tool.hatch.build.hooks.vcs]
        version-file = "src/my_package/_version.py"
      \end{minted}
      \vspace{1em}
      \begin{minted}{python}
        # src/my_package/__init__.py
        from ._version import version

        __version__ = version
      \end{minted}
    \end{column}
  \end{columns}
\end{splitframe}

\begin{frame}{File Selection}
  \begin{center}
    \Large\textcolor{ccyan}{Hatch respects your \texttt{.gitignore} for what to include in each type
    of distribution:}
  \end{center}
  \begin{description}
    \item [\iref{https://packaging.python.org/en/latest/specifications/source-distribution-format/}{SDist}]
      Hatch will include everything \emph{not} included in \texttt{.gitignore}, unless told otherwise.
    \item [\iref{https://peps.python.org/pep-0427/}{Wheels}] Everything in \texttt{src/<project>/} excluding files in
    your \texttt{.gitignore}.
  \end{description}
\end{frame}

\begin{darkframe}[fragile]{Rewriting Paths}
  \begin{center}
    \Large\textcolor{ccyan}{\texttt{hatchling} can also move files around and rewrite paths in your Distribution package:}
  \end{center}
  \begin{minted}{toml}
    [tool.hatch.build.targets.wheel]
    include = ["src/my_package", "a-folder"]


    [tool.hatch.build.targets.wheel.sources]
    "src/my_package" = "my_package"
    "a-folder" = "my_package/renamed_folder"
  \end{minted}
\end{darkframe}

\begin{frame}{Data Files}
  \begin{description}
    \item [Data Files] Any files intended for use at \emph{runtime} that are shipped with your package
    and are not code.
  \end{description}

  \begin{itemize}
    \setlength{\itemsep}{1em}
    \item [\to] Can be configuration files or examples
    \item [\to] Data files are best put in a well-defined directory that can be accessed by users
  \end{itemize}
\end{frame}

\begin{darkframe}{Data Files}
  \begin{itemize}
    \item Set up your data files in your \texttt{pyproject.toml}:
      \begin{minted}{toml}
        [tool.hatch.build.targets.wheel.shared-data]
        "a-file.json" = "share/a-file.json"
        "a-directory" = "etc/a-directory"
      \end{minted}
    \item Access them, \eg, using \texttt{sysconfig} or \texttt{importlib}
      \begin{minted}{python}
        # with sysconfig
        import sysconfig

        root = sysconfig.get_path("data", sysconfig.get_default_scheme())
        file_path = root + "/share/a-file.json"
      \end{minted}
      \vspace{1.5em}
      
      \begin{minted}{python}
        # with importlib_resources
        from importlib_resources import files

        file_path = files("my_package").joinpath("a-file")
      \end{minted}
  \end{itemize}
\end{darkframe}

\begin{darkframe}{Building and Inspecting a Wheel (Try It)}
  \begin{itemize}
    \setlength{\itemsep}{1.5em}
  \item A local package:
  \begin{minted}{shell-session}
   $ hatch build -t wheel:editable .
   $ zipinfo ./my_package*.whl
  \end{minted}

  \item Or a package from PyPI:
  \begin{minted}{shell-session}
    $ pip wheel --quiet --no-deps pyvisgen
    $ zipinfo ./pyvisgen*.whl
  \end{minted}
  \end{itemize}
\end{darkframe}

\begin{frame}{Further Reading: Packaging}
  \begin{itemize}
    \setlength{\itemsep}{1em}
    \item \iref{https://agoose77.github.io/packaging-pyopp-2025/}{Packaging in Python (Angus Hollands)}
    \item \iref{https://packaging.python.org/en/latest/}{Python Packaging User Guide}
    \item \iref{https://www.pypa.io/en/latest/}{Python Packaging Authority}
    \item \iref{https://hatch.pypa.io/latest/}{hatch}
    \item \iref{https://docs.astral.sh/uv/}{uv}
    \item \iref{https://mamba.readthedocs.io/en/latest/}{mamba}
    \item \iref{https://learn.scientific-python.org/development/}{Scientific Python Library Development Guide}
    \item \iref{https://learn.scientific-python.org/development/patterns/data-files/}{https://learn.scientific-python.org/development/patterns/data-files/}
  \end{itemize}
\end{frame}
